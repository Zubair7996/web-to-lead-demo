<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Web-to-Lead (Sandbox, 2-step)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{--brand:#0176d3;--ink:#1f1f1f;--muted:#6b7280;--bg:#fff;--panel:#f7f7f8}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--panel);color:var(--ink)}
    .wrap{max-width:760px;margin:6vh auto;padding:24px;background:var(--bg);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    h1{margin:.2rem 0 .6rem}
    .progress{color:var(--muted);margin:0 0 16px}
    .grid{display:grid;gap:14px}
    @media(min-width:640px){.two{grid-template-columns:1fr 1fr}}
    label{display:block;margin-bottom:6px}
    .req::after{content:" *";color:#e11d48}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:8px;background:#fff}
    input:focus,select:focus,textarea:focus{outline:0;border-color:var(--brand);box-shadow:0 0 0 3px rgba(1,118,211,.15)}
    fieldset{border:1px solid #e5e7eb;border-radius:10px;padding:12px}
    legend{padding:0 6px;color:#374151}
    .radio-row{display:flex;gap:18px;flex-wrap:wrap}
    .buttons{display:flex;gap:10px;margin-top:8px}
    .btn{appearance:none;border:0;border-radius:8px;padding:12px 16px;cursor:pointer}
    .btn-primary{background:var(--brand);color:#fff;font-weight:600}
    .btn-secondary{background:#eef2f7}
    .error{color:#b91c1c;font-size:.9rem;margin-top:4px}
    .help{color:var(--muted);font-size:.9rem;margin-top:4px}
    .step{display:none}
    .step[aria-hidden="false"]{display:block}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Contact sales</h1>
    <p class="progress" id="progress">Step 1 of 2</p>

    <!-- SANDBOX endpoint -->
    <form id="w2l" action="https://test.salesforce.com/servlet/servlet.WebToLead?encoding=UTF-8" method="POST" novalidate>
      <!-- REQUIRED -->
      <input type="hidden" name="oid" value="00DPv00000AnTB6" />
      <input type="hidden" name="retURL" value="https://Zubair7996.github.io/web-to-lead-demo/thankyou.html" />

      <!-- Routing attribution -->
      <input type="hidden" name="lead_source" value="Website" />

      <!-- ===== STEP 1 ===== -->
      <section class="step" id="step1" aria-hidden="false">
        <div class="grid two">
          <div>
            <label for="interested_service" class="req">Interested Service</label>
            <!-- 00N: 00NPz000007PzFk -->
            <select id="interested_service" name="00NPz000007PzFk" required>
              <option value="">— Select —</option>
              <option>Gas</option>
              <option>Electricity</option>
              <option>Both</option>
            </select>
            <div class="error" data-error-for="interested_service"></div>
          </div>

          <div>
            <fieldset>
              <legend class="req">Sustainable Products Interest</legend>
              <div class="radio-row">
                <label><input type="radio" name="sust_tmp" value="Yes" required> Yes</label>
                <label><input type="radio" name="sust_tmp" value="No"  required> No</label>
              </div>
              <div class="error" data-error-for="sust_tmp"></div>
            </fieldset>
            <!-- 00N: 00NPv00000AolM9 -->
            <input type="hidden" id="sust_hidden" name="00NPv00000AolM9" />
          </div>
        </div>

        <div class="grid two" style="margin-top:8px">
          <div>
            <label for="annual_consumption" class="req">Renewal Estimated Annual Consumption (kWh)</label>
            <!-- 00N: 00NPv00000Aonqz -->
            <input id="annual_consumption" name="00NPv00000Aonqz" type="number" inputmode="numeric" step="1" min="50001" required />
            <div class="help">Must be greater than 50,000.</div>
            <div class="error" data-error-for="annual_consumption"></div>
          </div>

          <div>
            <label for="sites_qty" class="req">How many sites would you like a quote for</label>
            <!-- 00N: 00NJ7000000qVJU -->
            <input id="sites_qty" name="00NJ7000000qVJU" type="number" inputmode="numeric" step="1" min="1" required />
            <div class="error" data-error-for="sites_qty"></div>
          </div>
        </div>

        <div style="margin-top:8px">
          <label for="contract_end_uk" class="req">Contract end date (DD/MM/YYYY)</label>
          <!-- UK-visible control -->
          <input
            id="contract_end_uk"
            type="text"
            inputmode="numeric"
            placeholder="DD/MM/YYYY"
            autocomplete="off"
            aria-describedby="contract_end_hint"
            required
            pattern="^(0?[1-9]|[12][0-9]|3[01])/(0?[1-9]|1[0-2])/[0-9]{4}$"
          />
          <div id="contract_end_hint" class="help">Example: 05/11/2025</div>
          <!-- Hidden field posted to Salesforce in MM/DD/YYYY -->
          <!-- 00N: 00NPv00000AolXR -->
          <input id="contract_end_hidden" type="hidden" name="00NPv00000AolXR" />
          <div class="error" data-error-for="contract_end"></div>
        </div>

        <div class="buttons">
          <button type="button" class="btn btn-primary" id="next1">Next</button>
        </div>
      </section>

      <!-- ===== STEP 2 ===== -->
      <section class="step" id="step2" aria-hidden="true">
        <div class="grid two">
          <div>
            <label for="first_name" class="req">First Name</label>
            <input id="first_name" name="first_name" maxlength="40" type="text" required />
            <div class="error" data-error-for="first_name"></div>
          </div>
          <div>
            <label for="last_name" class="req">Last Name</label>
            <input id="last_name" name="last_name" maxlength="80" type="text" required />
            <div class="error" data-error-for="last_name"></div>
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="phone" class="req">Telephone Number</label>
            <input id="phone" name="phone" maxlength="40" type="tel" required pattern="^[0-9 +()\-]{7,}$" />
            <div class="error" data-error-for="phone"></div>
          </div>
          <div>
            <label for="email" class="req">Email Address</label>
            <input id="email" name="email" maxlength="80" type="email" required />
            <div class="error" data-error-for="email"></div>
          </div>
        </div>

        <div>
          <label for="company" class="req">Business / Company Name</label>
          <input id="company" name="company" maxlength="255" type="text" required />
          <div class="error" data-error-for="company"></div>
        </div>

        <div class="grid two">
          <div>
            <label for="company_reg" class="req">Company Registration Number</label>
            <!-- 00N: 00NPz000007PzGZ -->
            <input id="company_reg" name="00NPz000007PzGZ" type="text" maxlength="50" required />
            <div class="error" data-error-for="company_reg"></div>
          </div>
          <div>
            <label for="business_sector" class="req">Business Sector</label>
            <select id="business_sector" name="industry" required>
              <option value="">— Select —</option>
              <option>Agriculture, Forestry, Mining</option><option>Manufacturing, Construction</option><option>Energy, Utilities</option>
              <option>Transport, Logistics, Storage</option><option>Data Infastructure, Telecom</option><option>Media, Creative Industries</option>
              <option>Real Estate, Housing</option><option>Financial Services, Banking</option><option>Professional Services (Law, Consulting, Cleaning, etc.)</option>
              <option>Entertainment, Recreation</option><option>Retail, Wholesale, Trade</option><option>Hospitality, Food, Leisure Travel</option>
              <option>Healthcare, Social Work</option><option>Education</option><option>Public Service, Social Service</option>
              <option>Other</option>
            </select>
            <div class="error" data-error-for="business_sector"></div>
          </div>
        </div>

        <div>
          <label for="trading_type" class="req">Trading Type</label>
          <!-- 00N: 00NPz000007PzFl -->
          <select id="trading_type" name="00NPz000007PzFl" required>
            <option value="">— Select —</option>
            <option>Limited</option><option>Sole Trader</option><option>Non Limited</option>
            <option>Charity</option><option>Public Sector</option><option>Other</option>
          </select>
          <div class="error" data-error-for="trading_type"></div>
        </div>

        <div class="buttons">
          <button type="button" class="btn btn-secondary" id="back2">Back</button>
          <button type="submit" class="btn btn-primary">Submit</button>
        </div>
      </section>
    </form>
  </div>

  <script>
    const form = document.getElementById('w2l');
    const steps = [document.getElementById('step1'), document.getElementById('step2')];
    const progress = document.getElementById('progress');

    function show(i){
      steps.forEach((s,idx)=> s.setAttribute('aria-hidden', idx===i ? 'false':'true'));
      progress.textContent = `Step ${i+1} of ${steps.length}`;
    }

    function setError(forKey, msg){
      const errEl = document.querySelector(`.error[data-error-for="${forKey}"]`);
      if (errEl) errEl.textContent = msg || '';
    }

    // Strict UK date parse: "DD/MM/YYYY" -> { d, m, y } or null
    function parseUKDate(uk){
      const m = /^(0?[1-9]|[12][0-9]|3[01])\/(0?[1-9]|1[0-2])\/([0-9]{4})$/.exec((uk||'').trim());
      if (!m) return null;
      let [ , dd, mm, yyyy ] = m;
      const d = parseInt(dd,10), mo = parseInt(mm,10), y = parseInt(yyyy,10);
      const js = new Date(y, mo-1, d);
      if (js.getFullYear()!==y || js.getMonth()!==mo-1 || js.getDate()!==d) return null; // WHY: catch 31/02
      return { d, m: mo, y };
    }

    // "DD/MM/YYYY" -> "MM/DD/YYYY"
    function ukToUS(uk){
      const p = parseUKDate(uk);
      if (!p) return '';
      const mm = String(p.m).padStart(2,'0');
      const dd = String(p.d).padStart(2,'0');
      return `${mm}/${dd}/${p.y}`;
    }

    function syncSustainability(){
      const v = document.querySelector('input[name="sust_tmp"]:checked')?.value;
      document.getElementById('sust_hidden').value = (v === 'Yes') ? 'true' : 'false';
    }

    function syncContractEndHidden(){
      const ukInput = document.getElementById('contract_end_uk');
      const hidden = document.getElementById('contract_end_hidden');
      hidden.value = ukToUS(ukInput.value);
    }

    function validateContractEndUK(){
      const ukInput = document.getElementById('contract_end_uk');
      const val = ukInput.value.trim();
      if (!val){
        setError('contract_end','Please enter a date (DD/MM/YYYY).');
        return false;
      }
      if (!parseUKDate(val)){
        setError('contract_end','Enter a valid date (DD/MM/YYYY).');
        return false;
      }
      setError('contract_end','');
      return true;
    }

    function validateStep1(){
      let ok = true;

      const isel = document.getElementById('interested_service');
      if (!isel.value){ setError('interested_service','Please select a service.'); ok=false; } else setError('interested_service','');

      const sustChoice = document.querySelector('input[name="sust_tmp"]:checked');
      if (!sustChoice){ setError('sust_tmp','Please choose Yes or No.'); ok=false; } else setError('sust_tmp','');

      const annual = document.getElementById('annual_consumption');
      const n = Number(annual.value);
      if (!annual.value || !Number.isFinite(n)){ setError('annual_consumption','Enter a number.'); ok=false; }
      else if (n <= 50000){ setError('annual_consumption','Must be greater than 50,000.'); ok=false; }
      else setError('annual_consumption','');

      const sites = document.getElementById('sites_qty');
      const sq = Number(sites.value);
      if (!sites.value || !Number.isFinite(sq)){ setError('sites_qty','Enter a number.'); ok=false; }
      else if (sq < 1){ setError('sites_qty','Must be at least 1.'); ok=false; }
      else setError('sites_qty','');

      if (!validateContractEndUK()) ok = false;

      return ok;
    }

    function validateStep2(){
      let ok = true;

      const fn = document.getElementById('first_name');
      const ln = document.getElementById('last_name');
      const comp = document.getElementById('company');
      const email = document.getElementById('email');
      const phone = document.getElementById('phone');
      const reg = document.getElementById('company_reg');
      const sector = document.getElementById('business_sector');
      const trading = document.getElementById('trading_type');

      if (!fn.value.trim()){ setError('first_name','First Name is required.'); ok=false; } else setError('first_name','');
      if (!ln.value.trim()){ setError('last_name','Last Name is required.'); ok=false; } else setError('last_name','');
      if (!comp.value.trim()){ setError('company','Company is required.'); ok=false; } else setError('company','');

      if (!email.value.trim()){ setError('email','Email is required.'); ok=false; }
      else if (!email.checkValidity()){ setError('email','Enter a valid email.'); ok=false; } else setError('email','');

      if (!phone.value.trim()){ setError('phone','Phone is required.'); ok=false; }
      else if (!phone.checkValidity()){ setError('phone','Enter a valid phone number.'); ok=false; } else setError('phone','');

      if (!reg.value.trim()){ setError('company_reg','Company Registration Number is required.'); ok=false; } else setError('company_reg','');

      if (!sector.value){ setError('business_sector','Please select a sector.'); ok=false; } else setError('business_sector','');
      if (!trading.value){ setError('trading_type','Please select a trading type.'); ok=false; } else setError('trading_type','');

      return ok;
    }

    // Step navigation
    document.getElementById('next1').addEventListener('click', ()=>{
      if (validateStep1()){
        syncSustainability();
        syncContractEndHidden(); // WHY: keep hidden in sync before moving on
        show(1);
      }
    });
    document.getElementById('back2').addEventListener('click', ()=> show(0));

    // Final submit
    form.addEventListener('submit', (e)=>{
      if (!validateStep2()){
        e.preventDefault();
        return;
      }
      // Defensive re-sync
      if (!validateContractEndUK()){
        e.preventDefault();
        show(0);
        return;
      }
      syncSustainability();
      syncContractEndHidden();
      // Optional: block submit if conversion failed
      if (!document.getElementById('contract_end_hidden').value){
        e.preventDefault();
        setError('contract_end','Enter a valid date (DD/MM/YYYY).');
        show(0);
      }
    });

    // UX nicety: auto-insert slashes for DD/MM/YYYY
    document.getElementById('contract_end_uk').addEventListener('input', (e)=>{
      const v = e.target.value.replace(/[^\d]/g,'').slice(0,8);
      const parts = [v.slice(0,2), v.slice(2,4), v.slice(4,8)].filter(Boolean);
      e.target.value = parts.join('/');
      setError('contract_end',''); // clear while typing
    });
  </script>
</body>
</html>
